<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Control Panel</title>
    <style>
        :root { --admin-primary: #2c3e50; --admin-accent: #e67e22; }
        body { font-family: sans-serif; margin: 0; display: flex; background: #f4f7f6; }
        .sidebar { width: 250px; height: 100vh; background: var(--admin-primary); color: white; padding: 20px; position: fixed; }
        .sidebar h2 { border-bottom: 1px solid #555; padding-bottom: 10px; }
        .sidebar a { color: #ddd; text-decoration: none; display: block; padding: 10px 0; }
        .sidebar a:hover { color: var(--admin-accent); }
        .main-content { margin-left: 270px; padding: 30px; width: calc(100% - 300px); }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-top: 5px solid var(--admin-accent); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #ecf0f1; color: var(--admin-primary); }
        .btn-approve { background: #27ae60; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-approve:hover { background: #219150; }
        .btn-reject { background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-reject:hover { background: #c0392b; }
        .user-badge { background: #dfe6e9; padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; color: #2d3436; font-weight: 600; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); }
        .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 60%; max-height: 80vh; overflow-y: auto; position: relative; }
        .close { position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .close:hover { color: black; }
        .btn-review { background: #3498db; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>üë®‚Äçüíª Admin Panel</h2>
    <p>Logged in as: <strong>{{ session['user'] }}</strong></p>
    <hr style="border: 0; border-top: 1px solid #555; margin: 20px 0;">
    <a href="{{ url_for('index') }}">üè† View Website</a>
    <a href="{{ url_for('logout') }}" style="margin-top: 20px; color: #ff7675;">üö™ Logout</a>
</div>

<div class="main-content">
    
    <div class="stat-card">
        <h1>Pending Approvals</h1>
        <p>Review the latest community submissions below:</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Recipe Title</th>
                <th>Posted By</th>
                <th>Full Recipe</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for recipe in recipes %}
            <tr>
                <td><strong>{{ recipe['title'] }}</strong></td>
                <td><span class="user-badge">üë§ {{ recipe['username'] }}</span></td>
                <td>
                    <button class="btn-review" onclick="openModal('{{ recipe.id }}')">Review Content üîç</button>
                </td>
                <td>
                    <div style="display: flex; gap: 10px;">
                        <form action="{{ url_for('approve_recipe', id=recipe['id']) }}" method="POST">
                            <button type="submit" class="btn-approve">Approve ‚úÖ</button>
                        </form>

                        <form action="{{ url_for('reject_recipe', id=recipe['id']) }}" method="POST">
                            <button type="submit" class="btn-reject">Reject ‚ùå</button>
                        </form>
                    </div>
                </td>
            </tr>

            <div id="modal-{{ recipe.id }}" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('{{ recipe.id }}')">&times;</span>
                    <h2 style="color: var(--admin-primary); margin-top: 0;">{{ recipe['title'] }}</h2>
                    <p style="color: #666; font-style: italic;">Submitted by: {{ recipe['username'] }}</p>
                    <hr>
                    
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <div style="flex: 1;">
                            <img src="{{ recipe['image_url'] or 'https://via.placeholder.com/300' }}" style="width: 100%; border-radius: 8px; border: 1px solid #ddd;">
                        </div>
                        <div style="flex: 1;">
                            <h4 style="color: var(--admin-accent); margin-bottom: 5px;">Ingredients</h4>
                            <p style="white-space: pre-wrap; background: #f9f9f9; padding: 10px; border-radius: 5px; font-size: 0.9rem;">{{ recipe['ingredients'] }}</p>
                        </div>
                    </div>

                    <h4 style="color: var(--admin-accent); margin-bottom: 5px; margin-top: 20px;">Instructions</h4>
                    <p style="white-space: pre-wrap; background: #f9f9f9; padding: 10px; border-radius: 5px; font-size: 0.9rem;">{{ recipe['instructions'] }}</p>
                    
                    <div style="margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px;">
                        <button onclick="closeModal('{{ recipe.id }}')" style="padding: 10px 20px; border-radius: 5px; border: 1px solid #ccc; cursor: pointer;">Close</button>
                    </div>
                </div>
            </div>

            {% else %}
            <tr>
                <td colspan="4" style="text-align:center; padding: 50px; color: #7f8c8d;">
                    No pending recipes! üéâ All submissions have been processed.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="stat-card" style="margin-top: 50px; border-top-color: #34495e;">
        <h1>User Management</h1>
        <p>Manage community members and access levels.</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Danger Zone</th>
            </tr>
        </thead>
        <tbody>
            {% for user in all_users %}
            <tr>
                <td><strong>{{ user['username'] }}</strong></td>
                <td>
                    <span style="color: {{ '#e67e22' if user['role'] == 'admin' else '#2c3e50' }}; font-weight: bold;">
                        {{ user['role'] | upper }}
                    </span>
                </td>
                <td>
                    {% if user['role'] != 'admin' %}
                    <form action="{{ url_for('delete_user', id=user['id']) }}" method="POST" onsubmit="return confirm('WARNING: This will delete the user and ALL their recipes. Continue?')">
                        <button type="submit" style="background: #ff7675; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Remove User üóëÔ∏è</button>
                    </form>
                    {% else %}
                    <span style="color: #bdc3c7; font-style: italic;">System Protected</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<script>
    function openModal(id) {
        document.getElementById('modal-' + id).style.display = "block";
        document.body.style.overflow = "hidden"; // Prevent scrolling behind modal
    }

    function closeModal(id) {
        document.getElementById('modal-' + id).style.display = "none";
        document.body.style.overflow = "auto"; // Re-enable scrolling
    }

    // Close modal if user clicks anywhere outside of the modal content
    window.onclick = function(event) {
        if (event.target.className === 'modal') {
            event.target.style.display = "none";
            document.body.style.overflow = "auto";
        }
    }
</script>

</body>
</html>